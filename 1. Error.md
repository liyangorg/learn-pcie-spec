## 6.2 Error Signaling and Logging

在这份文档中，哪些错误是必须被检测出来的、哪些错误是可选被检测的，都必须明确地标记出来。  
每一个错误必须和端口或者特定设备( or多功能设备的功能)关联起来，并且给出错误描述。  
**这节将会讨论错误分类和上报** 

### 6.2.1 范围

本节介绍PCI Express组件的错误信号和记录日志的要求。  

PCI Express肯定会发生错误。有的错误发生在PCI Express接口，有时错误发生在初始化的时候，有时发生在组件内部等等。

PCI Express定义了两种错误上报机制：baseline和Advanced Error Reporting(AER)。从名字都可以看出，所有的PCI Express设备都支持baseline机制，一些难搞的错误则需要更加强大的AER机制来搞定。 AER用一个特殊的PCI Express Capability结构体来实现。

除了PCI Express特有的错误处理 机制， 所有的PCI Express设备必须支持没有PCI Express软件支持的设备，即把PCI Express 错误映射到PCI错误上报机制来实现。



### 6.2.2  错误分类

PCI Express错误可以分为两类：可纠正的错误，不可纠正的错误。**这个分类方式把那些导致功能失败，和那些导致性能降低的错误区分开来。**不可纠正的错误可以进一步细分为Fatal和Non-Fatal。根据错误的严重程度，错误可以分为 **致命**、**不可纠正**、**可纠正**错误，然后就可以为这些不同类别的错误选择适当的错误处理机制。

例如，平台可能会选择低优先级的性能监控软件来响应可纠正的错误。一些软件可以统计可纠正错误的频率，并且提供完整的信息。然而，平台可能会直接映射致命错误到系统级别的重置操作，平台会把这些严重级别PCI Express错误映射到系统级的严重级别。

#### 6.2.2.1 可纠正的错误

可纠正的错误包括：**硬件**可以在不丢失信息的情况下恢复。硬件可以纠正错误，而不需要软件干涉。  例如，LCRC错误可以被视为一个可纠正错误，它一般可以被Data Link Level Retry纠正。测试链路级的可纠正错误的频率可能有助于分析链路的完整性。

可纠正的错误也包括：**事务级**的情况。一个代理检测到TLP的错误，另外一个代理有义务在需要的情况下，采用任何恢复手段，比如使用单独的后续事务来重新尝试操作。这个检测代理可以被配置为将错误报告为可纠正的，因为恢复代理可能能够纠正错误。如果的确需要恢复，但是恢复代理决定不去修复，那么恢复代理必须上报该错误为不可纠正的错误。

Downstream Port Contaiment（DPC）的触发不视为错误来处理，但是它可以作为可纠正的错误发出信号，因为利用DPC的软件有时可以从触发DPC的不可恢复错误中恢复。

#### 6.2.2.2 不可纠正的错误

##### 6.2.2.2.1 致命错误

##### 6.2.2.2.2 非致命错误



### 6.2.3 错误信号

有三种互补的机制让检测到错误的代理来告诉系统或者设备--有一个错误已经发生了。 第一种：通过一个Completion Status，第二种：in-band 错误消息，第三种：错误转发。

Note. 检测错误的代理应该适当地发送错误信号。
